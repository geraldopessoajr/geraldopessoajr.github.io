<!DOCTYPE html>
<meta charset="utf-8">
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Researchers by Academic Age</title>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style2.css">
</head>
<body>
<!--Div com Cabeçalho-->
  <div id="cabecalho"> 
	</br>
	<h1 align="center"> Distribution of Researchers by Academic Age </h1>
        </br>
        <div style="display: flex;justify-content: flex-start;">
<!--Select para selecionar qual gráfico-->
          <div>
            <select id="idioma" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="0">Select</option>
	      <option value="1">Portuguese</option>
	      <option value="2">English</option>
	      <option value="3">Back</option>
	    </select>
	  </div>
          <div>
            <select id="area" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="1">Agrarian Sciences</option>
	      <option value="2">Applied and Social Sciences</option>
	      <option value="3">Biological Sciences</option>
	      <option value="4">Engineering</option>
              <option value="5">Exact and Earth Sciences</option>
	      <option value="6">Health Sciences</option>
	      <option value="7">Humanities</option>
	      <option value="8">Linguistics Letters and Arts</option>
	    </select>
	  </div>
        </div>
      </br></br>
  </div>

  <div id="corpo">

	  <div id="corpo1" style="display: flex;justify-content: space-between;">
	    <div id="corpo1-1">
	    </div>  
	    <div id="corpo1-2">
	    </div>
	  </div>

  </div>


    <div id="rodape"> 
        <p> Todos os Direitos Reservados </p>
    </div>
<!--Inicio do JavaScript no Código-->
  <script>
        function atualiza_div(idioma, area)
	{
	     d3.select("svg").remove();
	     d3.select("svg").remove();
             
             if(idioma == 2)
             {
                  if(area == 1)
                  {
		     imprimeGrafico(2, "Agrarian Sciences", "Agrarian Sciences", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(2, "Applied and Social Sciences", "Applied and Social Sciences", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(2, "Biological Sciences", "Biological Sciences", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(2, "Engineering", "Engineering", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(2, "Exact and Earth Sciences", "Exact and Earth Sciences", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(2, "Health Sciences", "Health Sciences", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(2, "Humanities", "Humanities", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(2, "Linguistics Letters and Arts", "Linguistics Letters and Arts", 'corpo1-1', 'div#corpo1-1');
                  }
                  imprimeLegenda("../files/idade"+idioma+"legenda.csv", 'corpo1-2', 'div#corpo1-2');
             }
             else if(idioma == 1)
             {
                  if(area == 1)
                  {
		     imprimeGrafico(1, "Agrarian Sciences","Ciências Agrárias", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(1, "Biological Sciences","Ciências Biológicas", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(1, "Health Sciences", "Ciências da Saúde", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(1, "Exact and Earth Sciences", "Ciências Exatas e da Terra", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(1, "Humanities", "Ciências Humanas", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(1, "Applied and Social Sciences", "Ciências Sociais e Aplicadas", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(1, "Engineering", "Engenharias", 'corpo1-1', 'div#corpo1-1');
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(1, "Linguistics Letters and Arts", "Linguística Letras e Artes",'corpo1-1', 'div#corpo1-1');
                  }
		  imprimeLegenda("../files/idade"+idioma+"legenda.csv", 'corpo1-2', 'div#corpo1-2');
            }
            else  if(idioma == 3)
            {
               window.location.assign("../index.html");
            }
	}
	function imprimeGrafico(idioma, great_area, arquivo, corpo, div)
        {

            var stack = d3.layout.stack();
            var dataset =[];
     

		    if(great_area == "Agrarian Sciences")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":9.07,"month":"[0,10]"},
		                    {"y":48.72,"month":"(10,20]"},
		                    {"y":42.21,"month":">20"}
		                ],
		                [
		                    {"y":10.07,"month":"[0,10]"},
		                    {"y":48.08,"month":"(10,20]"},
		                    {"y":41.85,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Applied and Social Sciences")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":11.28,"month":"[0,10]"},
		                    {"y":51.13,"month":"(10,20]"},
		                    {"y":37.59,"month":">20"}
		                ],
		                [
		                    {"y":14.79,"month":"[0,10]"},
		                    {"y":45.90,"month":"(10,20]"},
		                    {"y":39.31,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Biological Sciences")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":10.26,"month":"[0,10]"},
		                    {"y":49.28,"month":"(10,20]"},
		                    {"y":40.46,"month":">20"}
		                ],
		                [
		                    {"y":11.24,"month":"[0,10]"},
		                    {"y":48.19,"month":"(10,20]"},
		                    {"y":40.57,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Engineering")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":10.32,"month":"[0,10]"},
		                    {"y":41.56,"month":"(10,20]"},
		                    {"y":48.12,"month":">20"}
		                ],
		                [
		                    {"y":13.02,"month":"[0,10]"},
		                    {"y":40.88,"month":"(10,20]"},
		                    {"y":46.10,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Exact and Earth Sciences")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":12.25,"month":"[0,10]"},
		                    {"y":43.62,"month":"(10,20]"},
		                    {"y":44.13,"month":">20"}
		                ],
		                [
		                    {"y":16.03,"month":"[0,10]"},
		                    {"y":41.48,"month":"(10,20]"},
		                    {"y":42.49,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Health Sciences")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":7.75,"month":"[0,10]"},
		                    {"y":44.58,"month":"(10,20]"},
		                    {"y":47.67,"month":">20"}
		                ],
		                [
		                    {"y":8.39,"month":"[0,10]"},
		                    {"y":43.47,"month":"(10,20]"},
		                    {"y":48.14,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Humanities")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":6.96,"month":"[0,10]"},
		                    {"y":45.92,"month":"(10,20]"},
		                    {"y":47.12,"month":">20"}
		                ],
		                [
		                    {"y":11.08,"month":"[0,10]"},
		                    {"y":46.73,"month":"(10,20]"},
		                    {"y":42.19,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }
                    else if(great_area == "Linguistics Letters and Arts")
		    {
		       dataset = {
		        "categories": ["[0,10]", "(10,20]", ">20"],
		        "series": ['Global','Interdisciplinary'],
		        "colors": ["#ef8a62", "#67a9cf"],
		        "layers": [
		                [
		                    {"y":9.81,"month":"[0,10]"},
		                    {"y":46.43,"month":"(10,20]"},
		                    {"y":43.76,"month":">20"}
		                ],
		                [
		                    {"y":15.18,"month":"[0,10]"},
		                    {"y":48.55,"month":"(10,20]"},
		                    {"y":36.27,"month":">20"}
		                ]
		            ]
		          }
		          n = dataset["series"].length; // Number of Layers
		          m = dataset["layers"].length; // Number of Samples in 1 layer
		    }



    var formatPercent = d3.format(".0%");

    var margin = {top: 30, right: 30, bottom: 30, left: 30},
	width = document.getElementById(corpo).offsetWidth - (margin.left) - (margin.right),
	height = document.getElementById(corpo).offsetHeight - (margin.top) - (margin.bottom);

    var x = d3.scale.ordinal()
        .domain(dataset["categories"])
        .rangeRoundBands([0, width], .08);

    var y = d3.scale.linear()
        .domain([0, 0.55])
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .tickSize(5)
        .tickPadding(6)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .tickFormat(formatPercent);

    var svg = d3.select(div).append("svg")
        .attr("width", width + (margin.left + margin.right))
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var layer = svg.selectAll(".layer")
        .data(dataset["layers"])
        .enter().append("g")
        .attr("class", "layer");

    var rect = layer.selectAll("rect")
        .data(function(d,i){d.map(function(b){b.colorIndex=i;return b;});return d;})
        .enter()
    rect.append("rect")
        .attr("x", function(d, i, j) { return x(d.month) + x.rangeBand() / n * j; })
        .attr("width", x.rangeBand() / n)
        .attr("y", function(d) { return y(d.y/100); })
        .attr("height", function(d) { return height - y(d.y/100)})
        .attr("class","bar")
        .style("fill",function(d){return dataset["colors"][d.colorIndex];})

    rect.append("text").text(function(d) {return d.y+"%";})
       .attr("x", function(d, i, j) { return 22+(x(d.month) + x.rangeBand() / n * j); })
       .attr("y", function(d) {return y(d.y/100)-6;})
       .attr("text-anchor", "middle");

    svg.append("g")
       .attr("class", "x axis")
       .attr("transform", "translate(0," + height + ")")
       .call(xAxis);

//definido o dominio y do gráfico
    svg.append("g")
        .attr("class", "y axis")
	.call(yAxis)
        .append("text")
	.attr("transform", "rotate(-90)")
	.attr("y", 6)
	.attr("dy", ".71em")
	.style("text-anchor", "end")
	.text(function(){if(idioma == 1){return "Frequência";}else{return "Frequency"}});

//Título do Gráfico *tittle* é adicionado aqui no svg
        svg.append("text")
	    .attr("x", (width / 2))             
	    .attr("y", 0 - (margin.top / 2))
	    .attr("text-anchor", "middle")  
	    .style("font-size", "20px") 
	    .text(arquivo);

	   /* // add legend
	    var legend = svg.append("g")
	      .attr("class", "legend")

	    legend.selectAll('text')
	      .data(dataset["colors"])
	      .enter()
	      .append("rect")
	      .attr("x", margin.right)
	      .attr("y", function(d, i){ return i *  20;})
	      .attr("width", 10)
	      .attr("height", 10)
	      .style("fill", function(d) {
		return d;
	      })

	    legend.selectAll('text')
	      .data(dataset["series"])
	      .enter()
	    .append("text")
	    .attr("x", margin.right + 25)
	    .attr("y", function(d, i){ return i *  20 + 9;})
	    .text(function(d){return d});*/
	}

	function imprimeLegenda(arquivo, corpo, div)
        {

             var legendRectSize = 18;                              
             
             var legendSpacing = 4; 
             
             var color = d3.scale.ordinal(d3.schemeCategory20b);
 
             
             var margin = {top: 30, right: 10, bottom: 30, left: 32},
			  width = document.getElementById(corpo).offsetWidth - (margin.left) - (margin.right),
			  height = document.getElementById(corpo).offsetHeight - (margin.top) - (margin.bottom);


//cria o svg que receberá o Grafico
	     var svg = d3.select(div).append("svg")
		  .attr("width", width + margin.left + margin.right)
		  .attr("height", height + margin.top + margin.bottom)
		.append("g")
		  .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
             
             d3.csv(arquivo, function(error, dataset) {  

//Chama a legenda na div corpo 2. E define o tamanho do quadrinho dessa legenda 
		 var legend = svg.selectAll('.legend')                     
		    .data(dataset)                                   
		    .enter()                                                
		    .append('g')                                            
		    .attr('class', 'legend')                                
		    .attr('transform', function(d, i) {                     
		       var height = legendRectSize + legendSpacing;          
		       var offset =  height * color.domain().length / 2;     
		       var horz = legendRectSize;                       
		       var vert = i * height - offset;                       
		       return 'translate(' + horz + ',' + vert + ')';        
		       });

                 legend.append('rect')                                      // NEW
                    .attr('width', legendRectSize)                          // NEW
                    .attr('height', legendRectSize)                         // NEW
                    .style('fill', function(d) {return d.color})            // NEW
                    .style('stroke', color);                                // NEW                                                     
//Os dizeres que serão mostrado na legenda, bem como seu espaço e posição		  
		 legend.append('text')                                     
		    .attr('x', legendRectSize + legendSpacing)              
		    .attr('y', legendRectSize - legendSpacing)              
		    .text(function(d) {return d.type;});
                                      
	     });
	}
        
        function get_idioma()
        {
          var idiomas = document.getElementById('idioma')
          return idiomas.options[idioma.selectedIndex].value
        }

        function get_area()
        {
          var areas = document.getElementById('area')
          return areas.options[area.selectedIndex].value
        }

        function sum(arr) {
          return arr.reduce(function (a, b) {
             return a + b;
           }, 0);
        }
  </script>
<!--Final do JavaScript no Código-->
</body>
</html>
