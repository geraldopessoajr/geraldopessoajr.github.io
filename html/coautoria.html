<!DOCTYPE html>
<meta charset="utf-8">
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Collaborations per Major Area</title>
    <script src="../js/d3.v3.min.js"></script>
    <script src="../js/d3.tip.v0.6.3.js"></script>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    

    <!-- Custom styles for this template -->
    <link href="../css/style2.css" rel="stylesheet">
  </head>

  <body>
   
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <a class="navbar-brand" href="../index.html">Home</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="https://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Collaborations per Major Area</a>
            <div class="dropdown-menu" aria-labelledby="dropdown01">
              <a class="dropdown-item" href="./coautoria.html">per Great Area</a>
              <a class="dropdown-item" href="./coautoriaTodos.html">All Great Areas</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="https://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Collaborations per Geographical Region</a>
            <div class="dropdown-menu" aria-labelledby="dropdown01">
              <a class="dropdown-item" href="./region.html">per Region</a>
              <a class="dropdown-item" href="./regionTodos.html">All Regions</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="https://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Researchers by Academic Age</a>
            <div class="dropdown-menu" aria-labelledby="dropdown01">
              <a class="dropdown-item" href="./idade.html">per Academic Age</a>
              <a class="dropdown-item" href="./idadeTodos.html">All Academic Ages</a>
              <a class="dropdown-item" href="./idadeArea.html">per Great Area</a>
              <a class="dropdown-item" href="./idadeAreaTodos.html">All Great Areas</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="https://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Temporal analysis</a>
            <div class="dropdown-menu" aria-labelledby="dropdown01">
              <a class="dropdown-item" href="./distTempo.html">per Great Area</a>
              <a class="dropdown-item" href="./distTempoTodos.html">All Great Areas</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>

    <main role="main" class="container">

      <div class="starter-template">
        <h1>Collaborations per Major Area</h1>
        <!-- <p class="lead">Use this document as a way to quickly start any new project.<br> All you get is this text and a mostly barebones HTML document.</p> -->
      </div>

    </main><!-- /.container -->

    <div id="corpo">
        <div style="display: flex;justify-content: flex-start;">
<!--Select para selecionar qual gráfico-->
          <div>
            <select id="area" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="1">Agrarian Sciences</option>
	      <option value="2">Applied and Social Sciences</option>
	      <option value="3">Biological Sciences</option>
	      <option value="4">Engineering</option>
              <option value="5">Exact and Earth Sciences</option>
	      <option value="6">Health Sciences</option>
	      <option value="7">Humanities</option>
	      <option value="8">Linguistics Letters and Arts</option>
	    </select>
	  </div>
          <div>
            <select id="idioma" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="1">Portuguese</option>
	      <option value="2" selected>English</option>
	    </select>
	  </div>
        </div>
        </br></br>    
	  <div id="corpo1" style="display: flex;justify-content: space-between;">
	    <div id="corpo1-1">
	    </div>  
	    <div id="corpo1-2">
	    </div>
	  </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<!--Inicio do JavaScript no Código-->
  <script>
        function atualiza_div(idioma, area)
	{
             d3.select("svg").remove();
	     d3.select("svg").remove();
             
             if(idioma == 2)
             {
                  if(area == 1)
                  {
		     imprimeGrafico(2, "Agrarian Sciences", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(2, "Applied and Social Sciences", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(2, "Biological Sciences", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(2, "Engineering", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(2, "Exact and Earth Sciences", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(2, "Health Sciences", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(2, "Humanities", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(2, "Linguistics Letters and Arts", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  imprimeLegenda("../files/coautoria"+idioma+"legenda.csv", 'corpo1-2');
             }
             else if(idioma == 1)
             {
                  if(area == 1)
                  {
		     imprimeGrafico(1, "Ciências Agrárias", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(1, "Ciências Biológicas", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(1, "Ciências da Saúde", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(1, "Ciências Exatas e da Terra", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(1, "Ciências Humanas", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(1, "Ciências Sociais e Aplicadas", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(1, "Engenharias", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(1, "Linguística Letras e Artes", "../files/coautoria"+idioma+".csv", 'corpo1-1');
                  }
		  imprimeLegenda("../files/coautoria"+idioma+"legenda.csv", 'corpo1-2');
            }

	}

	function imprimeGrafico(idioma, great_area, arquivo, divsvg)
        {

             var margin = {top: 30, right: 30, bottom: 30, left: 30},
			  width = document.getElementById(divsvg).offsetWidth - (margin.left) - (margin.right),
			  height = document.getElementById(divsvg).offsetHeight - (margin.top) - (margin.bottom);

             var formatPercent = d3.format(".0%");

	     var x = d3.scale.ordinal()
		  .rangeRoundBands([0, width+ (margin.left)], .1);

	     var y = d3.scale.linear()
		  .range([height, 0]);

	     var xAxis = d3.svg.axis()
		  .scale(x)
		  .orient("bottom");

             var yAxis = d3.svg.axis()
		  .scale(y)
		  .orient("left")
		  .tickFormat(formatPercent);

	     var tip = d3.tip()
		  .attr('class', 'd3-tip')
		  .offset([-10, 0])
		  .html(function(d) {return "<span style='color:white'>" + d.coautoria + "%</span>";});


//cria o svg que receberá o Grafico
	     var svg = d3.select("div#"+divsvg).append("svg")
		  .attr("width", width + (margin.left + margin.right))
		  .attr("height", height + margin.top + margin.bottom)
		.append("g")
		  .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
                             
             svg.call(tip);

             var dataset = [];
//le o csv e                 
             d3.csv(arquivo, function(error, data) {  
                  data.forEach(function(d)
                  {   
                    if(d.great_area1 == great_area)// então seleciona somente os dados que atender as condições selecionadas pelo usuário
                    {
	             
                       dataset.push(d);
                    }//e as insere na variável dataset
                  });
               
               //dataset.sort(function(a, b){return a.coautoria-b.coautoria});
               x.domain(dataset.map(function(d){return d.sigla;}));
               y.domain([0, 0.75]);

//definido o dominio x do gráfico
	          svg.append("g")
		    .attr("class", "x axis")
		    .attr("transform", "translate(0," + height + ")")
		    //.call(xAxis);

//definido o dominio y do gráfico
	          svg.append("g")
		    .attr("class", "y axis")
		    .call(yAxis)
		    .append("text")
		    .attr("transform", "rotate(-90)")
		    .attr("y", 6)
		    .attr("dy", ".71em")
		    .style("text-anchor", "end")
		    .text(function(){if(idioma == 1){return "Frequência";}else{return "Frequency"}});

//Título do Gráfico *tittle* é adicionado aqui no svg
		  svg.append("text")
		    .attr("x", (width / 2))             
		    .attr("y", 0 - (margin.top / 2)+10)
		    .attr("text-anchor", "middle")  
		    .style("font-size", "30px") 
		    .text(great_area);

//Cria o gráfico. do tipo barra utilizando os dados que satisfaçam o usuário. o gráfico inicia com 0 no y e é mudado na transição
                  var bars = svg.selectAll(".bar")
		    .data(dataset)
		    .enter()
                  bars.append("rect")
		    .attr("class", "bar")
		    .attr("x", function(d) {return x(d.sigla)})
		    .attr("width", x.rangeBand())
		    .attr("y", function(d) {return y(d.coautoria/100);})
		    .attr("height", function(d) {return height - y(d.coautoria/100);})
		    .style("fill", function(d) {return d.color})
		    .on('mouseover', tip.show)
		    .on('mouseout', tip.hide)

                 bars.append("text").text(function(d) {return d.coautoria+"%";})
		    .attr("x", function(d) { return x(d.sigla)+x.rangeBand()/2; })
		    .attr("y", function(d) {return y(d.coautoria/100)-6;})
		    .attr("text-anchor", "middle")
                    .style("font-size", "16px");

                                      
	     });
	}

	function imprimeLegenda(arquivo, divsvg)
        {

             var legendRectSize = 18;                              
             
             var legendSpacing = 4; 
             
             var color = d3.scale.ordinal(d3.schemeCategory20b);
 
             
             var margin = {top: 30, right: 10, bottom: 30, left: 32},
			  width = document.getElementById(divsvg).offsetWidth - (margin.left) - (margin.right),
			  height = document.getElementById(divsvg).offsetHeight - (margin.top) - (margin.bottom);


//cria o svg que receberá o Grafico
	     var svg = d3.select("div#"+divsvg).append("svg")
		  .attr("width", width + margin.left + margin.right)
		  .attr("height", height + margin.top + margin.bottom)
		.append("g")
		  .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
             
             d3.csv(arquivo, function(error, dataset) {  

//Chama a legenda na div corpo 2. E define o tamanho do quadrinho dessa legenda 
		 var legend = svg.selectAll('.legend')                     
		    .data(dataset)                                   
		    .enter()                                                
		    .append('g')                                            
		    .attr('class', 'legend')                                
		    .attr('transform', function(d, i) {                     
		       var height = legendRectSize + legendSpacing;          
		       var offset =  height * color.domain().length / 2;     
		       var horz = legendRectSize;                       
		       var vert = i * height - offset;                       
		       return 'translate(' + horz + ',' + vert + ')';        
		       });

                 legend.append('rect')                                      // NEW
                    .attr('width', legendRectSize)                          // NEW
                    .attr('height', legendRectSize)                         // NEW
                    .style('fill', function(d) {return d.color})            // NEW
                    .style('stroke', color);                                // NEW                                                     
//Os dizeres que serão mostrado na legenda, bem como seu espaço e posição		  
		 legend.append('text')                                     
		    .attr('x', legendRectSize + legendSpacing)              
		    .attr('y', legendRectSize - legendSpacing)              
		    .text(function(d) {return d.great_area1;});
                                      
	     });
	}
        
        function get_idioma()
        {
          var idiomas = document.getElementById('idioma')
          return idiomas.options[idioma.selectedIndex].value
        }

        function get_area()
        {
          var areas = document.getElementById('area')
          return areas.options[area.selectedIndex].value
        }

  </script>
<!--Final do JavaScript no Código-->     
  <script> atualiza_div(2, 1);</script>
  </body>
</html>
