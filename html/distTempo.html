<!DOCTYPE html>
<meta charset="utf-8">
<html lang="pt-br">

<head>
  <meta charset="UTF-8">

  <style> /* set the CSS */
    path { 
       stroke: steelblue;
       stroke-width: 2;
       fill: none;
   }
   .axis path,
   .axis line {
      fill: none;
      stroke: grey;
      stroke-width: 1;
      shape-rendering: crispEdges;
}
</style>
  <title>Collaborations per Major Area</title>
  <script src="../js/d3.v3.min.js"></script>
  <script src="../js/d3.tip.v0.6.3.js"></script>
  <link rel="stylesheet" type="text/css" href="../css/style3.css">
</head>
<body>
<!--Div com Cabeçalho-->
  <div id="cabecalho"> 
	</br>
	<h1 align="center"> Percentage of Collaborations per Major Area </h1>
        </br>
        <div style="display: flex;justify-content: flex-start;">
<!--Select para selecionar qual gráfico-->
          <div>
            <select id="idioma" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="0">Select</option>
	      <option value="1">Portuguese</option>
	      <option value="2">English</option>
	      <option value="3">Back</option>
	    </select>
	  </div>
          <div>
            <select id="area" onchange="atualiza_div(get_idioma(), get_area());">
              <option value="1">Agrarian Sciences</option>
	      <option value="2">Applied and Social Sciences</option>
	      <option value="3">Biological Sciences</option>
	      <option value="4">Engineering</option>
              <option value="5">Exact and Earth Sciences</option>
	      <option value="6">Health Sciences</option>
	      <option value="7">Humanities</option>
	      <option value="8">Linguistics Letters and Arts</option>
	    </select>
	  </div>
        </div>
      </br></br>
  </div>

  <div id="corpo">

	  <div id="corpo1" style="display: flex;justify-content: space-between;">
	    <div id="corpo1-1">
	    </div>  
	    <div id="corpo1-2">
	    </div>
	  </div>
  </div>


    <div id="rodape"> 
        <p> Todos os Direitos Reservados </p>
    </div>
<!--Inicio do JavaScript no Código-->
  <script>
        function atualiza_div(idioma, area)
	{
	     d3.select("svg").remove();
	     d3.select("svg").remove();
             
             if(idioma == 2)
             {
		  dataset = {
		    "series": ["Agrarian Sciences","Applied and Social Sciences", "Biological Sciences","Engineering", "Exact and Earth Sciences","Health Sciences","Humanities","Linguistics Letters and Arts"],             "colors": ["#2166ac", "#4393c3", "#92c5de", "#d1e5f0", "#fddbc7", "#f4a582", "#d6604d", "#b2182b"]
		  }

                  if(area == 1)
                  {
		     imprimeGrafico(2, "Agrarian Sciences", "../files/at_cienciasagrarias"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(2, "Applied and Social Sciences", "../files/at_cienciassociaisaplicadas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(2, "Biological Sciences", "../files/at_cienciasbiologicas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(2, "Engineering", "../files/at_engenharias"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(2, "Exact and Earth Sciences", "../files/at_cienciasexatasedaterra"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(2, "Health Sciences", "../files/at_cienciasdasaude"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(2, "Humanities", "../files/at_cienciashumanas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(2, "Linguistics Letters and Arts", "../files/at_linguisticaletraseartes"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
             }
             else if(idioma == 1)
             {
		 dataset = {
		    "series": ["Ciências Agrárias","Ciências Biológicas","Ciências da Saúde","Ciências Exatas e da Terra","Ciências Humanas","Ciências Sociais e Aplicadas","Engenharias","Linguitíca Letras e Artes"],           "colors": ["#2166ac", "#4393c3", "#92c5de", "#d1e5f0", "#fddbc7", "#f4a582", "#d6604d", "#b2182b"]
		  }
                  if(area == 1)
                  {
		     imprimeGrafico(1, "Ciências Agrárias", "../files/at_cienciasagrarias"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 3)
                  {
		     imprimeGrafico(1, "Ciências Biológicas", "../files/at_cienciasbiologicas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 6)
                  {
		     imprimeGrafico(1, "Ciências da Saúde", "../files/at_cienciasdasaude"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 5)
                  {
		     imprimeGrafico(1, "Ciências Exatas e da Terra", "../files/at_cienciasexatasedaterra"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 7)
                  {
		     imprimeGrafico(1, "Ciências Humanas", "../files/at_cienciashumanas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 2)
                  {
		     imprimeGrafico(1, "Ciências Sociais e Aplicadas", "../files/at_cienciassociaisaplicadas"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 4)
                  {
		     imprimeGrafico(1, "Engenharias", "../files/at_engenharias"+idioma+".csv", 'corpo1-1', 'div#corpo1-1', dataset);
                  }
                  else if(area == 8)
                  {
		     imprimeGrafico(1, "Linguística Letras e Artes", "../files/at_linguisticaletraseartes"+idioma+".csv", 'corpo1-1', 'div#corpo1-1',dataset);
                  }
            }
            else  if(idioma == 3)
            {
               window.location.assign("../index.html");
            }

	}

	function imprimeGrafico(idioma, great_area, arquivo, corpo, div, dataset)
        {

             var margin = {top: 30, right: 30, bottom: 30, left: 50},
			  width = document.getElementById(corpo).offsetWidth - (margin.left) - (margin.right),
			  height = document.getElementById(corpo).offsetHeight - (margin.top) - (margin.bottom);

             var parseDate = d3.time.format("%Y").parse;

	     var x = d3.time.scale().range([0, width]);
             var y = d3.scale.linear().range([height, 0]);

             var xAxis = d3.svg.axis().scale(x).tickSize(5).tickPadding(6).orient("bottom").ticks(5);
             var yAxis = d3.svg.axis().scale(y).orient("left").ticks(5);

             var line = d3.svg.line()  
		  .interpolate("linear")
		  .x(function(d) { return x(d.ano); })
		  .y(function(d) { return y(d.qtde); });


//cria o svg que receberá o Grafico
	     var svg = d3.select(div).append("svg")
		  .attr("width", width + (margin.left + margin.right))
		  .attr("height", height + margin.top + margin.bottom)
		.append("g")
		  .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
                             
             d3.csv(arquivo, function(error, data) {
		    data.forEach(function(d) {
				d.ano = parseDate(d.ano);
				d.qtde = +d.qtde;
		    });
               
               x.domain(d3.extent(data, function(d) { return d.ano; }));
               y.domain([0, (1.10*d3.max(data, function(d) {return (parseInt(d.qtde));}))]);


		// Nest the entries by symbol
		    var dataNest = d3.nest()
			.key(function(d) {return d.great_area;})
			.entries(data);
		    var color = d3.scale.category10();
		 // set the colour scale
		    // Loop through each symbol / key
		    dataNest.forEach(function(d) {
			svg.append("path")
			    .attr("class", "line")
			    .style("stroke", function() { // Add dynamically
				return d["values"][0].color; })
			    .attr("d", line(d.values));
		    });

//definido o dominio x do gráfico
                  svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);


//definido o dominio y do gráfico
	          svg.append("g")
		    .attr("class", "y axis")
		    .call(yAxis)
		    .append("text")
		    .attr("transform", "rotate(-90)")
		    .attr("y", 6)
		    .attr("dy", ".71em")
		    .style("text-anchor", "end")
		    .text(function(){if(idioma == 1){return "Número de Publicações";}else{return "Number of Publications"}});

//Título do Gráfico *tittle* é adicionado aqui no svg
		  svg.append("text")
		    .attr("x", (width / 2))             
		    .attr("y", 0 - (margin.top / 2))
		    .attr("text-anchor", "middle")  
		    .style("font-size", "20px") 
		    .text(great_area);


		    var legend = svg.append("g")
		      .attr("class", "legend")

                    legend.selectAll('text')
		      .data(dataset["colors"])
		      .enter()
		      .append("rect")
		      .attr("x", function(d, i){return margin.right+20})
		      .attr("y", function(d, i){return i *  15;})
		      .attr("width", 10)
		      .attr("height", 10)
		      .style("fill", function(d) {
			return d;
		      })

		    legend.selectAll('text')
		      .data(dataset["series"])
		      .enter()
		    .append("text")
		    .attr("x", function(d, i){return margin.right+45})
		    .attr("y", function(d, i){return i *  15+9;})
		    .text(function(d){return d});

                                      
	     });
	}

	function imprimeLegenda(arquivo, corpo, div)
        {

             var legendRectSize = 18;                              
             
             var legendSpacing = 4; 
             
             var color = d3.scale.ordinal(d3.schemeCategory20b);
 
             
             var margin = {top: 30, right: 10, bottom: 30, left: 32},
			  width = document.getElementById(corpo).offsetWidth - (margin.left) - (margin.right),
			  height = document.getElementById(corpo).offsetHeight - (margin.top) - (margin.bottom);


//cria o svg que receberá o Grafico
	     var svg = d3.select(div).append("svg")
		  .attr("width", width + margin.left + margin.right)
		  .attr("height", height + margin.top + margin.bottom)
		.append("g")
		  .attr("transform", "translate(" + margin.left + "," + margin.top + ")"); 
             
             d3.csv(arquivo, function(error, dataset) {  

//Chama a legenda na div corpo 2. E define o tamanho do quadrinho dessa legenda 
		 var legend = svg.selectAll('.legend')                     
		    .data(dataset)                                   
		    .enter()                                                
		    .append('g')                                            
		    .attr('class', 'legend')                                
		    .attr('transform', function(d, i) {                     
		       var height = legendRectSize + legendSpacing;          
		       var offset =  height * color.domain().length / 2;     
		       var horz = legendRectSize;                       
		       var vert = i * height - offset;                       
		       return 'translate(' + horz + ',' + vert + ')';        
		       });

                 legend.append('rect')                                      // NEW
                    .attr('width', legendRectSize)                          // NEW
                    .attr('height', legendRectSize)                         // NEW
                    .style('fill', function(d) {return d.color})            // NEW
                    .style('stroke', color);                                // NEW                                                     
//Os dizeres que serão mostrado na legenda, bem como seu espaço e posição		  
		 legend.append('text')                                     
		    .attr('x', legendRectSize + legendSpacing)              
		    .attr('y', legendRectSize - legendSpacing)              
		    .text(function(d) {return d.great_area1;});
                                      
	     });
	}
        
        function get_idioma()
        {
          var idiomas = document.getElementById('idioma')
          return idiomas.options[idioma.selectedIndex].value
        }

        function get_area()
        {
          var areas = document.getElementById('area')
          return areas.options[area.selectedIndex].value
        }

        function sum(arr) {
          return arr.reduce(function (a, b) {
             return a + b;
           }, 0);
        }
  </script>
<!--Final do JavaScript no Código-->
</body>
</html>
